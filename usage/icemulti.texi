@pindex icemulti
@cindex @code{icemulti} program, usage
@example
icemulti [@var{option}]@dots{} @var{input-file}@dots{}
@end example

@noindent
The @code{icemulti} program creates a multi-configuration image for
Lattice iCE40 FPGAs from up to four individual configuration images.
This is used with the coldboot and warmboot mechanisms which allow to
select a configuration image to be loaded after a reset based on the
values read from the @code{CBSEL0} and @code{CBSEL1} pins or on the
values of the @code{fabout} nets of I/O tiles 13 1 and 13 2,
respectively.

@code{icemulti} is typically invoked after the bitstream has been
converted to the iCE40 @code{.bin} format by @code{icepack} and before
programming the resulting image onto the configuration flash using
@code{iceprog}.

@subsection Options

@table @code
@item -c
@itemx --coldboot
Enable coldboot mode: the image which is loaded on power-on or after a
low pulse on @code{CRESET_B} is determined by the values read from the
pins @code{CBSEL0} and @code{CBSEL1}.

@item -p @var{index}
When not using coldboot mode, specify the image to be used on power-on
or after a low pulse on @code{CRESET_B}.  @var{index} must be in the
range 0@dots{}3.  This option can't be used in combination with
@option{-c}.

@item -a @var{N}
Align the images to 2@sup{@var{N}} bytes within the resulting bitstream.
The resulting extra space is filled with @code{0xff}.

@item -A @var{N}
Like @option{-a@var{N}}, but align the first image, too.

@item -o @var{output-file}
Write the resulting bitstream to @var{output-file}.  (If this option
is not specified, the default is to print it to the standard output.)

@item -v
@itemx --verbose
Print the image offsets to stderr.
@end table


@subsection Resulting bitstream

The bitstream generated by @command{icemulti} consists of five 32-byte
headers followed by the actual configuration images.  If the options
@option{-a} or @option{-A} have been specified, the unused bytes
between the images are filles with @code{0xff}.

Each header specifies the start offset of an image: the first header
specifies the the offset of the image to be used on power-on or after
a low pulse on @code{CRESET_B} unless coldboot is used, and the
following headers specify the offsets of the four images available via
the coldboot or warmboot mechanism.  Unused headers point to the first
configuration image.  In addition, the first header contains a bit
specifying whether the coldboot mechanism should be used.


@subsection Exit status

Returns @samp{0} on success and @samp{1} on failure.
